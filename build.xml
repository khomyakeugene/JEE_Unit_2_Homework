<project name="JEE_Unit_2_Homework" basedir="." default="main">

    <property name="src.dir" value="src"/>
    <property name="build.dir" value="build"/>
    <property name="deploy.dir" value="deploy"/>
    <property name="classes.dir" value="${build.dir}/classes"/>
    <property name="jar.dir" value="${build.dir}/jar"/>
    <property name="jar.name" value="${ant.project.name}.jar"/>
    <property name="build.jar.name" value="${jar.dir}/${jar.name}"/>
    <property name="deploy.name" value="${deploy.dir}/${jar.name}"/>
    <property name="test.dir" value="test"/>
    <property name="report.dir" value="${test.dir}/report"/>
    <property name="report.filename" value="${report.dir}/test_results"/>
    <property name="junit.dir" location="${ant.home}/.." />
    <property name="junit.jar" location="${junit.dir}/junit-4.12.jar"/>
    <property name="hamcrest.jar" location="${junit.dir}/hamcrest-core-1.3.jar"/>
    <property name="test.class.name" value="com.company.tasks.implementation.TaskExecutorTest"/>

    <target name="clean.build.data">
        <delete dir="${jar.dir}"/>
        <delete dir="${build.dir}"/>
    </target>

    <target name="clean.test.result">
        <delete dir="${report.dir}"/>
    </target>

    <target name="clean">
        <antcall target="clean.build.data"/>
        <antcall target="clean.test.result"/>
    </target>

    <target name="compile" depends="clean">
        <mkdir dir="${classes.dir}"/>
        <javac srcdir="${src.dir}" destdir="${classes.dir}" source="1.8" target="1.8"/>
    </target>

    <target name="compile.test" depends="compile">
        <mkdir dir="${classes.dir}"/>
        <javac srcdir="${test.dir}" destdir="${classes.dir}" classpath="${junit.jar}" source="1.8" target="1.8"/>
    </target>

    <target name="test" depends="compile.test">
        <mkdir dir="${report.dir}"/>
        <junit printsummary="yes" haltonfailure="yes">
            <classpath location="${junit.jar}"/>
            <classpath location="${hamcrest.jar}"/>
            <classpath location="${classes.dir}"/>

            <test name="${test.class.name}" haltonfailure="yes" outfile="${report.filename}">
                <formatter type="plain" />
            </test>
        </junit>
    </target>

    <target name="jar" depends="test,compile">
        <mkdir dir="${jar.dir}"/>
        <jar destfile="${build.jar.name}" basedir="${classes.dir}"/>
    </target>

    <target name="deploy" depends="jar">
        <delete dir="${deploy.dir}"/>
        <mkdir dir="${deploy.dir}"/>
        <copy file="${build.jar.name}" todir="${deploy.dir}"/>
        <antcall target="clean.build.data"/>
    </target>

    <target name="main" depends="clean,deploy"/>
</project>